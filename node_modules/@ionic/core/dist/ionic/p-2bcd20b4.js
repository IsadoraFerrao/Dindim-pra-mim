import{p as o}from"./p-01cf4201.js";const t=new WeakMap,n=(o,n,i,a=0)=>{t.has(o)!==i&&(i?r(o,n,a):e(o,n))},i=o=>o===o.getRootNode().activeElement,r=(o,n,i)=>{const r=n.parentNode,e=n.cloneNode(!1);e.classList.add("cloned-input"),e.tabIndex=-1,r.appendChild(e),t.set(o,e);const a="rtl"===o.ownerDocument.dir?9999:-9999;o.style.pointerEvents="none",n.style.transform=`translate3d(${a}px,${i}px,0) scale(0)`},e=(o,n)=>{const i=t.get(o);i&&(t.delete(o),i.remove()),o.style.pointerEvents="",n.style.transform=""},a="input, textarea, [no-blur]",c=async(o,t,i,r,e)=>{if(!i&&!r)return;const a=((o,t,n)=>((o,t,n,i)=>{const r=o.top,e=o.bottom,a=t.top,c=a+15,s=.75*Math.min(t.bottom,i-n)-e,u=c-r,d=Math.round(s<0?-s:u>0?-u:0),l=Math.min(d,r-a),f=Math.abs(l);return{scrollAmount:l,scrollDuration:Math.min(400,Math.max(150,f/.3)),scrollPadding:n,inputSafeY:4-(r-c)}})((o.closest("ion-item,[ion-item]")||o).getBoundingClientRect(),t.getBoundingClientRect(),n,o.ownerDocument.defaultView.innerHeight))(o,i||r,e);if(i&&Math.abs(a.scrollAmount)<4)t.focus();else if(n(o,t,!0,a.inputSafeY),t.focus(),"undefined"!=typeof window){let r;const e=async()=>{void 0!==r&&clearTimeout(r),window.removeEventListener("ionKeyboardDidShow",c),window.removeEventListener("ionKeyboardDidShow",e),i&&await i.scrollByPoint(0,a.scrollAmount,a.scrollDuration),n(o,t,!1,a.inputSafeY),t.focus()},c=()=>{window.removeEventListener("ionKeyboardDidShow",c),window.addEventListener("ionKeyboardDidShow",e)};if(i){const o=await i.getScrollElement();if(a.scrollAmount>o.scrollHeight-o.clientHeight-o.scrollTop)return"password"===t.type?(a.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",c)):window.addEventListener("ionKeyboardDidShow",e),void(r=setTimeout(e,1e3))}e()}},s=(o,t)=>{if("INPUT"!==o.tagName)return;if(o.parentElement&&"ION-INPUT"===o.parentElement.tagName)return;if(o.parentElement&&o.parentElement.parentElement&&"ION-SEARCHBAR"===o.parentElement.parentElement.tagName)return;const n=o.closest("ion-content");if(null===n)return;const i=n.$ionPaddingTimer;i&&clearTimeout(i),t>0?n.style.setProperty("--keyboard-offset",t+"px"):n.$ionPaddingTimer=setTimeout(()=>{n.style.setProperty("--keyboard-offset","0px")},120)},u=t=>{const r=document,e=t.getNumber("keyboardHeight",290),u=t.getBoolean("scrollAssist",!0),d=t.getBoolean("hideCaretOnScroll",!0),l=t.getBoolean("inputBlurring",!0),f=t.getBoolean("scrollPadding",!0),w=Array.from(r.querySelectorAll("ion-input, ion-textarea")),p=new WeakMap,h=new WeakMap,S=async t=>{t.componentOnReady&&await t.componentOnReady();const r=t.shadowRoot||t,a=r.querySelector("input")||r.querySelector("textarea"),s=t.closest("ion-content"),l=s?null:t.closest("ion-footer");if(a){if(s&&d&&!p.has(t)){const o=((o,t,r)=>{if(!r||!t)return()=>{};const e=r=>{i(t)&&n(o,t,r)},a=()=>n(o,t,!1),c=()=>e(!0),s=()=>e(!1);return r.addEventListener("ionScrollStart",c),r.addEventListener("ionScrollEnd",s),t.addEventListener("blur",a),()=>{r.removeEventListener("ionScrollStart",c),r.removeEventListener("ionScrollEnd",s),t.addEventListener("ionBlur",a)}})(t,a,s);p.set(t,o)}if((s||l)&&u&&!h.has(t)){const n=((t,n,r,e,a)=>{let s;const u=t=>{s=o(t)},d=u=>{if(!s)return;const d=o(u);((o,t,n)=>{if(t&&n){const i=t.x-n.x,r=t.y-n.y;return i*i+r*r>o*o}return!1})(6,s,d)||i(n)||(u.preventDefault(),u.stopPropagation(),c(t,n,r,e,a))};return t.addEventListener("touchstart",u,!0),t.addEventListener("touchend",d,!0),()=>{t.removeEventListener("touchstart",u,!0),t.removeEventListener("touchend",d,!0)}})(t,a,s,l,e);h.set(t,n)}}};l&&(()=>{let o=!0,t=!1;const n=document;n.addEventListener("ionScrollStart",()=>{t=!0}),n.addEventListener("focusin",()=>{o=!0},!0),n.addEventListener("touchend",i=>{if(t)return void(t=!1);const r=n.activeElement;if(!r)return;if(r.matches(a))return;const e=i.target;e!==r&&(e.matches(a)||e.closest(a)||(o=!1,setTimeout(()=>{o||r.blur()},50)))},!1)})(),f&&(o=>{const t=document;t.addEventListener("focusin",t=>{s(t.target,o)}),t.addEventListener("focusout",o=>{s(o.target,0)})})(e);for(const o of w)S(o);r.addEventListener("ionInputDidLoad",o=>{S(o.detail)}),r.addEventListener("ionInputDidUnload",o=>{(o=>{if(d){const t=p.get(o);t&&t(),p.delete(o)}if(u){const t=h.get(o);t&&t(),h.delete(o)}})(o.detail)})};export{u as startInputShims}